import{j as T,E as V,G as y,t as M,k as P,F as I,l as $,a as v,v as H,D as b}from"./index-z_3bUTQL.js";const N=["align","breakWords","cssOverrides","fontVariant","fontWeight","leading","letterSpacing","lineHeight","padding","textBaseline","trim","whiteSpace","wordWrap","wordWrapWidth","fontFamily","fontStyle","fontSize"];function j(n){const t=[];let e=0;for(let i=0;i<N.length;i++){const s=`_${N[i]}`;t[e++]=n[s]}return e=D(n._fill,t,e),e=O(n._stroke,t,e),e=G(n.dropShadow,t,e),t.join("-")}function D(n,t,e){var i;return n&&(t[e++]=n.color,t[e++]=n.alpha,t[e++]=(i=n.fill)==null?void 0:i.styleKey),e}function O(n,t,e){return n&&(e=D(n,t,e),t[e++]=n.width,t[e++]=n.alignment,t[e++]=n.cap,t[e++]=n.join,t[e++]=n.miterLimit),e}function G(n,t,e){return n&&(t[e++]=n.alpha,t[e++]=n.angle,t[e++]=n.blur,t[e++]=n.distance,t[e++]=T.shared.setValue(n.color).toNumber()),e}const A=class B extends V{constructor(t={}){super(),q(t);const e={...B.defaultTextStyle,...t};for(const i in e){const s=i;this[s]=e[i]}this.update()}get align(){return this._align}set align(t){this._align=t,this.update()}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords=t,this.update()}get dropShadow(){return this._dropShadow}set dropShadow(t){t!==null&&typeof t=="object"?this._dropShadow=this._createProxy({...B.defaultDropShadow,...t}):this._dropShadow=t?this._createProxy({...B.defaultDropShadow}):null,this.update()}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily=t,this.update()}get fontSize(){return this._fontSize}set fontSize(t){typeof t=="string"?this._fontSize=parseInt(t,10):this._fontSize=t,this.update()}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle=t.toLowerCase(),this.update()}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant=t,this.update()}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight=t,this.update()}get leading(){return this._leading}set leading(t){this._leading=t,this.update()}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing=t,this.update()}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight=t,this.update()}get padding(){return this._padding}set padding(t){this._padding=t,this.update()}get trim(){return this._trim}set trim(t){this._trim=t,this.update()}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline=t,this.update()}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace=t,this.update()}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap=t,this.update()}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth=t,this.update()}get fill(){return this._originalFill}set fill(t){t!==this._originalFill&&(this._originalFill=t,this._isFillStyle(t)&&(this._originalFill=this._createProxy({...y.defaultFillStyle,...t},()=>{this._fill=M({...this._originalFill},y.defaultFillStyle)})),this._fill=M(t===0?"black":t,y.defaultFillStyle),this.update())}get stroke(){return this._originalStroke}set stroke(t){t!==this._originalStroke&&(this._originalStroke=t,this._isFillStyle(t)&&(this._originalStroke=this._createProxy({...y.defaultStrokeStyle,...t},()=>{this._stroke=P({...this._originalStroke},y.defaultStrokeStyle)})),this._stroke=P(t,y.defaultStrokeStyle),this.update())}_generateKey(){return this._styleKey=j(this),this._styleKey}update(){this._styleKey=null,this.emit("update",this)}reset(){const t=B.defaultTextStyle;for(const e in t)this[e]=t[e]}get styleKey(){return this._styleKey||this._generateKey()}clone(){return new B({align:this.align,breakWords:this.breakWords,dropShadow:this._dropShadow?{...this._dropShadow}:null,fill:this._fill,fontFamily:this.fontFamily,fontSize:this.fontSize,fontStyle:this.fontStyle,fontVariant:this.fontVariant,fontWeight:this.fontWeight,leading:this.leading,letterSpacing:this.letterSpacing,lineHeight:this.lineHeight,padding:this.padding,stroke:this._stroke,textBaseline:this.textBaseline,whiteSpace:this.whiteSpace,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth})}destroy(t=!1){var i,s,a,o;if(this.removeAllListeners(),typeof t=="boolean"?t:t==null?void 0:t.texture){const l=typeof t=="boolean"?t:t==null?void 0:t.textureSource;(i=this._fill)!=null&&i.texture&&this._fill.texture.destroy(l),(s=this._originalFill)!=null&&s.texture&&this._originalFill.texture.destroy(l),(a=this._stroke)!=null&&a.texture&&this._stroke.texture.destroy(l),(o=this._originalStroke)!=null&&o.texture&&this._originalStroke.texture.destroy(l)}this._fill=null,this._stroke=null,this.dropShadow=null,this._originalStroke=null,this._originalFill=null}_createProxy(t,e){return new Proxy(t,{set:(i,s,a)=>(i[s]=a,e==null||e(s,a),this.update(),!0)})}_isFillStyle(t){return(t??null)!==null&&!(T.isColorLike(t)||t instanceof I||t instanceof $)}};A.defaultDropShadow={alpha:1,angle:Math.PI/6,blur:0,color:"black",distance:5};A.defaultTextStyle={align:"left",breakWords:!1,dropShadow:null,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,padding:0,stroke:null,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let R=A;function q(n){const t=n;if(typeof t.dropShadow=="boolean"&&t.dropShadow){const e=R.defaultDropShadow;n.dropShadow={alpha:t.dropShadowAlpha??e.alpha,angle:t.dropShadowAngle??e.angle,blur:t.dropShadowBlur??e.blur,color:t.dropShadowColor??e.color,distance:t.dropShadowDistance??e.distance}}if(t.strokeThickness!==void 0){v(H,"strokeThickness is now a part of stroke");const e=t.stroke;let i={};if(T.isColorLike(e))i.color=e;else if(e instanceof I||e instanceof $)i.fill=e;else if(Object.hasOwnProperty.call(e,"color")||Object.hasOwnProperty.call(e,"fill"))i=e;else throw new Error("Invalid stroke value.");n.stroke={...i,width:t.strokeThickness}}if(Array.isArray(t.fillGradientStops)){v(H,"gradient fill is now a fill pattern: `new FillGradient(...)`");let e;n.fontSize==null?n.fontSize=R.defaultTextStyle.fontSize:typeof n.fontSize=="string"?e=parseInt(n.fontSize,10):e=n.fontSize;const i=new I({start:{x:0,y:0},end:{x:0,y:(e||0)*1.7}}),s=t.fillGradientStops.map(a=>T.shared.setValue(a).toNumber());s.forEach((a,o)=>{const l=o/(s.length-1);i.addColorStop(l,a)}),n.fill={fill:i}}}const U=["serif","sans-serif","monospace","cursive","fantasy","system-ui"];function Y(n){const t=typeof n.fontSize=="number"?`${n.fontSize}px`:n.fontSize;let e=n.fontFamily;Array.isArray(n.fontFamily)||(e=n.fontFamily.split(","));for(let i=e.length-1;i>=0;i--){let s=e[i].trim();!/([\"\'])[^\'\"]+\1/.test(s)&&!U.includes(s)&&(s=`"${s}"`),e[i]=s}return`${n.fontStyle} ${n.fontVariant} ${n.fontWeight} ${t} ${e.join(",")}`}const z={willReadFrequently:!0},u=class r{static get experimentalLetterSpacingSupported(){let t=r._experimentalLetterSpacingSupported;if(t!==void 0){const e=b.get().getCanvasRenderingContext2D().prototype;t=r._experimentalLetterSpacingSupported="letterSpacing"in e||"textLetterSpacing"in e}return t}constructor(t,e,i,s,a,o,l,g,p){this.text=t,this.style=e,this.width=i,this.height=s,this.lines=a,this.lineWidths=o,this.lineHeight=l,this.maxLineWidth=g,this.fontProperties=p}static measureText(t=" ",e,i=r._canvas,s=e.wordWrap){var k;const a=`${t}:${e.styleKey}`;if(r._measurementCache[a])return r._measurementCache[a];const o=Y(e),l=r.measureFont(o);l.fontSize===0&&(l.fontSize=e.fontSize,l.ascent=e.fontSize);const g=r.__context;g.font=o;const d=(s?r._wordWrap(t,e,i):t).split(/(?:\r\n|\r|\n)/),w=new Array(d.length);let x=0;for(let h=0;h<d.length;h++){const c=r._measureText(d[h],e.letterSpacing,g);w[h]=c,x=Math.max(x,c)}const S=((k=e._stroke)==null?void 0:k.width)||0;let W=x+S;e.dropShadow&&(W+=e.dropShadow.distance);const _=e.lineHeight||l.fontSize;let m=Math.max(_,l.fontSize+S)+(d.length-1)*(_+e.leading);return e.dropShadow&&(m+=e.dropShadow.distance),new r(t,e,W,m,d,w,_+e.leading,x,l)}static _measureText(t,e,i){let s=!1;r.experimentalLetterSpacingSupported&&(r.experimentalLetterSpacing?(i.letterSpacing=`${e}px`,i.textLetterSpacing=`${e}px`,s=!0):(i.letterSpacing="0px",i.textLetterSpacing="0px"));const a=i.measureText(t);let o=a.width;const l=-a.actualBoundingBoxLeft;let p=a.actualBoundingBoxRight-l;if(o>0)if(s)o-=e,p-=e;else{const d=(r.graphemeSegmenter(t).length-1)*e;o+=d,p+=d}return Math.max(o,p)}static _wordWrap(t,e,i=r._canvas){const s=i.getContext("2d",z);let a=0,o="",l="";const g=Object.create(null),{letterSpacing:p,whiteSpace:d}=e,w=r._collapseSpaces(d),x=r._collapseNewlines(d);let S=!w;const W=e.wordWrapWidth+p,_=r._tokenize(t);for(let m=0;m<_.length;m++){let f=_[m];if(r._isNewline(f)){if(!x){l+=r._addLine(o),S=!w,o="",a=0;continue}f=" "}if(w){const h=r.isBreakingSpace(f),c=r.isBreakingSpace(o[o.length-1]);if(h&&c)continue}const k=r._getFromCache(f,p,g,s);if(k>W)if(o!==""&&(l+=r._addLine(o),o="",a=0),r.canBreakWords(f,e.breakWords)){const h=r.wordWrapSplit(f);for(let c=0;c<h.length;c++){let F=h[c],E=F,C=1;for(;h[c+C];){const L=h[c+C];if(!r.canBreakChars(E,L,f,c,e.breakWords))F+=L;else break;E=L,C++}c+=C-1;const K=r._getFromCache(F,p,g,s);K+a>W&&(l+=r._addLine(o),S=!1,o="",a=0),o+=F,a+=K}}else{o.length>0&&(l+=r._addLine(o),o="",a=0);const h=m===_.length-1;l+=r._addLine(f,!h),S=!1,o="",a=0}else k+a>W&&(S=!1,l+=r._addLine(o),o="",a=0),(o.length>0||!r.isBreakingSpace(f)||S)&&(o+=f,a+=k)}return l+=r._addLine(o,!1),l}static _addLine(t,e=!0){return t=r._trimRight(t),t=e?`${t}
`:t,t}static _getFromCache(t,e,i,s){let a=i[t];return typeof a!="number"&&(a=r._measureText(t,e,s)+e,i[t]=a),a}static _collapseSpaces(t){return t==="normal"||t==="pre-line"}static _collapseNewlines(t){return t==="normal"}static _trimRight(t){if(typeof t!="string")return"";for(let e=t.length-1;e>=0;e--){const i=t[e];if(!r.isBreakingSpace(i))break;t=t.slice(0,-1)}return t}static _isNewline(t){return typeof t!="string"?!1:r._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,e){return typeof t!="string"?!1:r._breakingSpaces.includes(t.charCodeAt(0))}static _tokenize(t){const e=[];let i="";if(typeof t!="string")return e;for(let s=0;s<t.length;s++){const a=t[s],o=t[s+1];if(r.isBreakingSpace(a,o)||r._isNewline(a)){i!==""&&(e.push(i),i=""),e.push(a);continue}i+=a}return i!==""&&e.push(i),e}static canBreakWords(t,e){return e}static canBreakChars(t,e,i,s,a){return!0}static wordWrapSplit(t){return r.graphemeSegmenter(t)}static measureFont(t){if(r._fonts[t])return r._fonts[t];const e=r._context;e.font=t;const i=e.measureText(r.METRICS_STRING+r.BASELINE_SYMBOL),s={ascent:i.actualBoundingBoxAscent,descent:i.actualBoundingBoxDescent,fontSize:i.actualBoundingBoxAscent+i.actualBoundingBoxDescent};return r._fonts[t]=s,s}static clearMetrics(t=""){t?delete r._fonts[t]:r._fonts={}}static get _canvas(){if(!r.__canvas){let t;try{const e=new OffscreenCanvas(0,0),i=e.getContext("2d",z);if(i!=null&&i.measureText)return r.__canvas=e,e;t=b.get().createCanvas()}catch{t=b.get().createCanvas()}t.width=t.height=10,r.__canvas=t}return r.__canvas}static get _context(){return r.__context||(r.__context=r._canvas.getContext("2d",z)),r.__context}};u.METRICS_STRING="|ÉqÅ";u.BASELINE_SYMBOL="M";u.BASELINE_MULTIPLIER=1.4;u.HEIGHT_MULTIPLIER=2;u.graphemeSegmenter=(()=>{if(typeof(Intl==null?void 0:Intl.Segmenter)=="function"){const n=new Intl.Segmenter;return t=>[...n.segment(t)].map(e=>e.segment)}return n=>[...n]})();u.experimentalLetterSpacing=!1;u._fonts={};u._newlines=[10,13];u._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];u._measurementCache={};let Q=u;export{Q as C,R as T,Y as f,j as g};
